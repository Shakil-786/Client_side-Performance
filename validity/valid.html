<!DOCTYPE html>
<html>

<head>
    <title>URL Checker</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        h1 {
            font-size: 4rem;
            text-align: center;
            padding-top: 200px;

        }

        body {
            font-size: 2rem;
            color: white;
        }

        #body {
            text-align: center;
            padding-top: 50px;
        }

        #urlInput {
            text-align: left;
            width: 60rem;
        }

        #result {
            display: flex;
            margin-top: 4rex;
            margin-left: 450px;
        }
    </style>
</head>


<body style="background-image: url(../picture/abc.png); background-size: cover;">
    <h1>URL Checker</h1>
    <div id="body">
        <input type="text" id="urlInput" placeholder="Enter Url">
        <input type="text" id="timeInterval" placeholder="Time interval"
            style="display: none; margin-left: 360px; margin-top: 20px; width: 60rem;">
        <p id="resultMessage"></p>
    </div>
    <div id="result">
        <button id="checkButton" class="btn btn-primary btn-lg">Check URL</button>
        <button id="start" class="btn btn-primary btn-lg" style="margin-left: 20px;">Multiple Run </button>
        <button id="stop" class="btn btn-primary btn-lg" style="display: none; margin-left: 20px;"> Stop Multiple
            Run</button>
        <button id="openUrlButton" class="btn btn-primary btn-lg" style="display: none; margin-left:5%; ">Open
            URL</button>
    </div>
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    <script>
        let intervalId;

        document.getElementById('start').addEventListener('click', async () => {
            document.getElementById('timeInterval').style.display = 'block'
            document.getElementById('stop').style.display = 'block'

        })

        const url = document.getElementById('urlInput').value;


        function emailSend() {
            Email.send({
                Host: "smtp.elasticemail.com",
                Username: "annapurna.kg@nineleaps.com",
                Password: "06EE1C3FCDEAD71B36EC8D21812699DAA31D",
                To: 'annapurnanayak999@gmail.com',
                From: "annapurna.kg@nineleaps.com",
                Subject: "Mail regarding url",
                Body: "Website is down for now "
            }).then(

                message => document.getElementById('resultMessage').innerHTML = 'Link is Invalid. An Email has been sent to the admin.'


            );
        }

        document.getElementById('checkButton').addEventListener('click', async () => {
            console.log("clicked")

            async function rerun() {
                const url = document.getElementById('urlInput').value;
                console.log(url);
                if (!url) {
                    alert('Please enter a URL');
                    return;
                }

                const response = await fetch('http://localhost:3000/check_URL', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url })

                });

                console.log(response.status);
                if (response.status == 200 || response.status == 204) {
                    const textContent = "Link is valid"
                    document.getElementById('resultMessage').innerHTML = textContent;
                    document.getElementById('openUrlButton').style.display = 'block';


                } else {
                    emailSend()

                    document.getElementById('openUrlButton').style.display = 'none';
                }
            }


            rerun()
            const time = document.getElementById('timeInterval').value

            if (time != "") {

                const timeInMiliSecond = time * 60 * 1000
                intervalId = setInterval(rerun, timeInMiliSecond)
            }
        });

        document.getElementById('stop').addEventListener('click', () => {
            clearInterval(intervalId)
            console.log('clicking on stopbutton');
        })
        document.getElementById('openUrlButton').addEventListener('click', () => {

            const url = document.getElementById('urlInput').value
            const fullUrl = url.startsWith('http') ? url : `http://${url}`;
            window.open(fullUrl)
            document.getElementById('openUrlButton').style.display = 'none';
        })

    </script>
</body>


</html>